{"version":3,"sources":["../../controllers/vkapi.js"],"names":["https","require","vkapiget","req","res","post","json","vkapiGetLongPoll","clienttokenvk","get","er","data","send","response","vkapiGetHistory","body","vktoken","friendidvk","kekus","forEach","el","i","arr","splice","vkapiStartLongPoll","key","server","ts","pts","vkapiSendMessage","next","message","escape","toString","toconvert"],"mappings":"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","file":"vkapi.js","sourcesContent":["/**\r\n * Created by Semyon on 01.05.2017.\r\n */\r\nimport request from 'request';\r\nconst https = require('https');\r\nimport parse from 'parse-json-response';\r\nimport net from 'net';\r\nimport url from 'url';\r\nimport qs from 'querystring';\r\nexport const vkapiget = async (req, res) => {\r\n    request.post('https://api.vk.com/method/messages.send?peer_id=63049337&message=Привет&v=5.63');\r\n    res.json('zaaasd');\r\n};\r\nexport const vkapiGetLongPoll = async(req,res)=>{\r\n    const clienttokenvk='720c6c5e2bff13cee1cb4c1197f2d4b7d7589cba6c920a942c64b58886a1f50e53d18b2c36cf605fddff4';\r\n    https.get('https://api.vk.com/method/messages.getLongPollServer?access_token='+clienttokenvk+'&need_pts=1',  parse(function(er,data) {\r\n        res.send(data.response);\r\n    }));\r\n};\r\nexport const vkapiGetHistory = async(req,res)=>{\r\n    const clienttokenvk = req.body.vktoken;\r\n    const friendidvk =req.body.friendidvk;\r\n    https.get('https://api.vk.com/method/messages.getHistory?access_token='+clienttokenvk+'&user_id='+friendidvk+'&offset=0&',  parse(function(er,data) {\r\n        let kekus = data.response;\r\n        kekus.forEach(function (el,i,arr) {\r\n            if (typeof(arr[i])!='object'){\r\n                kekus.splice(i,1);\r\n            }\r\n        });\r\n        res.send(kekus);\r\n    }));\r\n};\r\n\r\nexport const vkapiStartLongPoll = async(req,res)=>{\r\n    const key ='574e2f4da375b05ae7c43cd5e8246589b4344418';\r\n    const server ='imv4.vk.com\\/im2308';\r\n    const ts='1832246197';\r\n    const pts ='10193396';\r\n\r\n    res.json('https://'+server+'?act=a_check&key='+key+'&ts='+ts+'&wait=25&mode=2&version=2', parse(function(er,data) {\r\n    res.send(data.response);\r\n    vkapiStartLongPoll();\r\n    }));\r\n};\r\n\r\nexport const vkapiSendMessage = async (req, res, next) => {\r\n    const clienttokenvk = req.body.vktoken;\r\n    const friendidvk = req.body.friendidvk;\r\n    let message = req.body.message;\r\n    message = qs.escape(message);\r\n    message = message.toString(\"utf-8\");\r\n    let toconvert =('https://api.vk.com/method/messages.send?user_id='+friendidvk+'&message='+message+'&access_token='+clienttokenvk) ;\r\n    https.get(toconvert.toString(\"utf-8\"));\r\n    res.json('Message was successfully sended');\r\n\r\n};"]}